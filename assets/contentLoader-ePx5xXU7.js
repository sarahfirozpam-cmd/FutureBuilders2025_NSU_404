class l{constructor(){this.cache=new Map,this.articleManifest=null}async loadArticles(e){if(this.cache.has(e))return this.cache.get(e);try{const t=await this.loadFromSrc(e);if(t.length>0)return this.cache.set(e,t),t;const n=await this.loadFromPublic(e);return this.cache.set(e,n),n}catch(t){return console.error(`Error loading ${e} articles:`,t),[]}}async loadFromSrc(e){try{const t=Object.assign({}),n=[];for(const s in t){const c=s.match(/\/articles\/([^/]+)\//);if(c&&c[1]===e){const i=await t[s]();n.push(i.default||i)}}return n}catch(t){return console.warn("Could not load from src folder:",t),[]}}async loadFromPublic(e){try{if(!this.articleManifest){const s="/health-content/manifest.json";console.log(`Fetching manifest from: ${s}`);const c=await fetch(s);if(!c.ok)throw new Error(`Manifest not found at ${s}. Check your public folder structure.`);this.articleManifest=await c.json()}const t=this.articleManifest[e]||[],n=[];for(const s of t)try{const c=`/health-content/articles/${e}/${s}`;console.log(`Attempting to fetch article: ${c}`);const i=await fetch(c);if(!i.ok){console.error(`Failed to reach ${c} - Status: ${i.status}`);continue}const o=i.headers.get("content-type");if(!o||!o.includes("application/json")){console.error(`Expected JSON from ${c} but received ${o}. Check if file exists.`);continue}const r=await i.json();n.push(r)}catch(c){console.error(`Error processing ${s}:`,c)}return n}catch(t){return console.error("Could not load from public folder:",t),[]}}async loadFromAPI(e){try{const t=await fetch(`/api/health-content/${e}`);if(!t.ok)throw new Error("API request failed");return await t.json()}catch(t){return console.error("API loading failed:",t),[]}}mergeArticles(e,t){const n=[],s=new Map(e.map(o=>[o.id,o])),c=new Map(t.map(o=>[o.id,o]));return new Set([...s.keys(),...c.keys()]).forEach(o=>{const r=s.get(o),a=c.get(o);!r&&!a||n.push({id:o,category:r?.category||a?.category,title:{en:r?.title||"Untitled",bn:a?.title||"শিরোনামহীন"},description:{en:r?.summary||this.truncate(r?.content,150),bn:a?.summary||this.truncate(a?.content,150)},content:{en:r?.content||"",bn:a?.content||""},thumbnail:r?.thumbnail||a?.thumbnail,author:r?.author||a?.author,createdAt:r?.createdAt||a?.createdAt,updatedAt:r?.updatedAt||a?.updatedAt,tags:[...new Set([...r?.tags||[],...a?.tags||[]])],size:this.calculateSize(r?.content||a?.content||"")})}),n.sort((o,r)=>new Date(r.createdAt||0)-new Date(o.createdAt||0))}calculateSize(e){const t=new Blob([e]).size;return t<1024?`${t} B`:t<1024*1024?`${(t/1024).toFixed(1)} KB`:`${(t/(1024*1024)).toFixed(1)} MB`}truncate(e,t=150){if(!e)return"";const n=e.replace(/<[^>]*>/g,"");return n.length>t?n.substring(0,t)+"...":n}clearCache(){this.cache.clear(),this.articleManifest=null}}const u=new l;export{u as default};
